<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Control Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #6f0302; }
        .btn { background: #6f0302; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn:hover { background: #5a0201; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .preview { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px dashed #dee2e6; }
        .code-block { background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px; overflow-x: auto; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 12px 24px; background: #e9ecef; border: none; cursor: pointer; border-radius: 8px 8px 0 0; margin-right: 2px; }
        .tab.active { background: #6f0302; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéõÔ∏è Chat Widget Control Panel</h1>
            <p>Controla todos los aspectos de tu widget sin tocar c√≥digo en el sitio del cliente.</p>
            
            <div class="form-group" style="margin-top: 20px;">
                <label>üè∑Ô∏è Site ID del Cliente</label>
                <select id="currentSiteId" onchange="loadClientConfig()">
                    <option value="aiprlassist-default">ü§ñ AI PRL Assist (Default) - Derek's Original</option>
                    <option value="webflow-windowed-001">Webflow Demo (webflow-windowed-001)</option>
                    <option value="woodstock-main">Woodstock Furniture (woodstock-main)</option>
                    <option value="client-demo-001">Cliente Demo (client-demo-001)</option>
                    <option value="restaurant-abc">Restaurante ABC (restaurant-abc)</option>
                    <option value="new">‚ûï Crear Nuevo Cliente</option>
                </select>
            </div>
            
            <div id="newClientForm" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <input type="text" id="newSiteId" placeholder="nuevo-cliente-001" style="width: 200px; margin-right: 10px;">
                <button class="btn" onclick="createNewClient()">Crear</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('config')">‚öôÔ∏è Configuraci√≥n</button>
            <button class="tab" onclick="showTab('preview')">üëÅÔ∏è Vista Previa</button>
            <button class="tab" onclick="showTab('deploy')">üöÄ Deploy & C√≥digo</button>
        </div>

        <div id="config" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h3>üé® Apariencia del Bubble</h3>
                    <div class="form-group">
                        <label>Posici√≥n</label>
                        <select id="position">
                            <option value="br">Abajo Derecha</option>
                            <option value="bl">Abajo Izquierda</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tama√±o (px)</label>
                        <input type="number" id="size" value="68" min="40" max="100">
                    </div>
                    <div class="form-group">
                        <label>Color de Fondo</label>
                        <input type="color" id="bg" value="#6f0302">
                    </div>
                    <div class="form-group">
                        <label>Color de Texto</label>
                        <input type="color" id="color" value="#ffffff">
                    </div>
                    <div class="form-group">
                        <label>Texto del Label</label>
                        <input type="text" id="label" placeholder="¬øNecesitas ayuda?">
                    </div>
                    <div class="form-group">
                        <label>URL del √çcono (opcional)</label>
                        <input type="url" id="iconUrl" placeholder="https://...">
                    </div>
                </div>

                <div class="card">
                    <h3>üí¨ Configuraci√≥n del Chat</h3>
                    <div class="form-group">
                        <label>URL Principal del Chat</label>
                        <input type="url" id="chatUrl" value="https://app.aiprlassist.com/webchat/?p=1047143&id=xaLiCGQ3VYp6mQF2k">
                    </div>
                    <div class="form-group">
                        <label>URL de Respaldo</label>
                        <input type="url" id="fallbackUrl" value="https://app.aiprlassist.com/webchat/?p=1047143&ref=1746442093403">
                    </div>
                    <div class="form-group">
                        <label>Modo Ventana (Desktop)</label>
                        <select id="windowMode">
                            <option value="true">Ventana Chica</option>
                            <option value="false">Full Screen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ancho Ventana (px)</label>
                        <input type="number" id="windowWidth" value="420" min="300" max="800">
                    </div>
                    <div class="form-group">
                        <label>Alto Ventana (px)</label>
                        <input type="number" id="windowHeight" value="650" min="400" max="900">
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>‚è∞ Triggers & Timing</h3>
                    <div class="form-group">
                        <label>Mostrar Bubble Despu√©s de (ms)</label>
                        <input type="number" id="showBubbleAfterMs" value="1000" min="0" max="10000">
                    </div>
                    <div class="form-group">
                        <label>Auto-abrir Despu√©s de (ms, 0=nunca)</label>
                        <input type="number" id="openAfterMs" value="0" min="0" max="30000">
                    </div>
                    <div class="form-group">
                        <label>Trigger por Scroll (%, 0=nunca)</label>
                        <input type="number" id="triggerOnScrollPercent" value="0" min="0" max="95">
                    </div>
                    <div class="form-group">
                        <label>Trigger por Exit Intent</label>
                        <select id="triggerOnExitIntent">
                            <option value="true">S√≠</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Frequency Cap (horas)</label>
                        <input type="number" id="frequencyCapHours" value="12" min="1" max="168">
                    </div>
                </div>

                <div class="card">
                    <h3>üí≠ Teaser Popup</h3>
                    <div class="form-group">
                        <label>Habilitar Teaser</label>
                        <select id="teaserEnabled">
                            <option value="true">S√≠</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Texto del Teaser</label>
                        <textarea id="teaserText" rows="3">¬°Hola! ¬øTe ayudo con algo?</textarea>
                    </div>
                    <div class="form-group">
                        <label>Delay del Teaser (ms)</label>
                        <input type="number" id="teaserDelayMs" value="3000" min="1000" max="15000">
                    </div>
                    <div class="form-group">
                        <label>Auto-cerrar Teaser (ms, 0=nunca)</label>
                        <input type="number" id="teaserAutocloseMs" value="8000" min="0" max="30000">
                    </div>
                </div>
            </div>

            <div class="card">
                <button class="btn" onclick="generateConfig()">üîÑ Generar Configuraci√≥n</button>
            </div>
        </div>

        <div id="preview" class="tab-content">
            <div class="card">
                <h3>üëÅÔ∏è Vista Previa</h3>
                <div class="preview">
                    <p>La vista previa aparecer√° aqu√≠ despu√©s de generar la configuraci√≥n.</p>
                    <div id="previewContent"></div>
                </div>
            </div>
        </div>

        <div id="deploy" class="tab-content">
            <div class="card">
                <h3>üìã C√≥digo para Integrar (GoHighLevel/Webflow/WordPress/etc.)</h3>
                <div class="warning">
                    <strong>‚ö†Ô∏è IMPORTANTE:</strong> Pega este snippet UNA sola vez en el footer del sitio del cliente.
                </div>
                <div class="code-block" id="webflowCode">
&lt;script src="https://dynamiccode-ochre.vercel.app/plugin.js"&gt;&lt;/script&gt;
&lt;script&gt;
ChatWidget.setup({
  // Opci√≥n A: URL directa del chat (ignora id/accountId)
  // chatUrl: "https://app.aiprlassist.com/webchat/?p=1047143&id=xaLiCGQ3VYp6mQF2k",

  // Opci√≥n B: Identificadores (equivalente a tu competidor)
  id: "O1T4KXJ9xZ",
  accountId: "1047143",

  // Apariencia y comportamiento
  color: "#E67E22",
  icon: "https://storage.googleapis.com/msgsndr/ecow5j0SgdAz2vzC0C4Q/media/68b225bbb40ac6d4eb8b4ded.png",
  position: "br",          // br | bl
  size: 68,
  windowMode: true,
  windowWidth: 420,
  windowHeight: 650,
  mobileFullscreen: true,
  showBubbleAfterMs: 1000,
  openAfterMs: 0

  // Opci√≥n C: Config remota (multi-tenant)
  // siteId: "webflow-windowed-001",
  // configUrl: "https://dynamiccode-ochre.vercel.app/configs/{{siteId}}.json"
});
&lt;/script&gt;
                </div>
            </div>

            <div class="card">
                <h3>üîß Configuraci√≥n JSON Generada</h3>
                <div class="success">
                    <strong>‚úÖ Autom√°tico:</strong> Los cambios se aplican autom√°ticamente al sitio cuando generas nueva configuraci√≥n.
                </div>
                <div class="code-block" id="jsonConfig">
                    Genera la configuraci√≥n primero...
                </div>
            </div>

            <div class="card">
                <h3>üéØ UTM Parameters Autom√°ticos</h3>
                <p>El widget captura autom√°ticamente estos par√°metros y los pasa al chat:</p>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li><code>utm_source</code> - Fuente del tr√°fico</li>
                    <li><code>utm_medium</code> - Medio del tr√°fico</li>
                    <li><code>utm_campaign</code> - Campa√±a</li>
                    <li><code>utm_term</code> - T√©rmino/palabra clave</li>
                    <li><code>utm_content</code> - Contenido espec√≠fico</li>
                    <li><code>host</code> - Dominio del sitio</li>
                    <li><code>page</code> - URL completa de la p√°gina</li>
                    <li><code>ref</code> - Referrer (de d√≥nde viene)</li>
                </ul>
                <p><strong>Ejemplo:</strong> Si alguien llega con <code>?utm_source=facebook&utm_campaign=promo2024</code>, el chat recibir√° esos datos autom√°ticamente.</p>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function generateConfig() {
            const config = {
                chatUrl: document.getElementById('chatUrl').value,
                fallbackUrl: document.getElementById('fallbackUrl').value,
                bubble: {
                    position: document.getElementById('position').value,
                    size: parseInt(document.getElementById('size').value),
                    bg: document.getElementById('bg').value,
                    color: document.getElementById('color').value,
                    outline: "#ffffff",
                    label: document.getElementById('label').value,
                    iconUrl: document.getElementById('iconUrl').value,
                    pulse: true
                },
                teaser: {
                    enabled: document.getElementById('teaserEnabled').value === 'true',
                    text: document.getElementById('teaserText').value,
                    delayMs: parseInt(document.getElementById('teaserDelayMs').value),
                    autocloseMs: parseInt(document.getElementById('teaserAutocloseMs').value)
                },
                triggers: {
                    showBubbleAfterMs: parseInt(document.getElementById('showBubbleAfterMs').value),
                    openAfterMs: parseInt(document.getElementById('openAfterMs').value),
                    triggerOnScrollPercent: parseInt(document.getElementById('triggerOnScrollPercent').value),
                    triggerOnExitIntent: document.getElementById('triggerOnExitIntent').value === 'true'
                },
                rules: {
                    includePaths: ["*"],
                    excludePaths: ["/checkout*", "/admin*"],
                    showOnMobile: true,
                    showOnDesktop: true,
                    minWidth: 0,
                    maxWidth: 99999,
                    frequencyCapHours: parseInt(document.getElementById('frequencyCapHours').value),
                    appendUTM: true
                },
                overlay: {
                    bg: "rgba(0,0,0,0.5)",
                    closeOnEsc: true,
                    windowMode: document.getElementById('windowMode').value === 'true',
                    windowWidth: document.getElementById('windowWidth').value + 'px',
                    windowHeight: document.getElementById('windowHeight').value + 'px'
                },
                analytics: {
                    console: true
                }
            };

            // Update JSON display
            document.getElementById('jsonConfig').textContent = JSON.stringify(config, null, 2);
            
            // Show success message
            alert('‚úÖ Configuraci√≥n generada! Copia el JSON y actualiza el archivo webflow-windowed-001.json en Vercel.');
        }

        function loadClientConfig() {
            const siteId = document.getElementById('currentSiteId').value;
            
            if (siteId === 'new') {
                document.getElementById('newClientForm').style.display = 'block';
                return;
            } else {
                document.getElementById('newClientForm').style.display = 'none';
            }
            
            // Update deploy code
            updateDeployCode(siteId);
            
            // Here you could fetch the actual config from the server
            // For now, we'll use defaults
            console.log('Loading config for:', siteId);
        }

        function createNewClient() {
            const newSiteId = document.getElementById('newSiteId').value.trim();
            if (!newSiteId) {
                alert('Por favor ingresa un Site ID v√°lido');
                return;
            }
            
            // Add to dropdown
            const select = document.getElementById('currentSiteId');
            const option = document.createElement('option');
            option.value = newSiteId;
            option.textContent = `Nuevo Cliente (${newSiteId})`;
            select.insertBefore(option, select.lastElementChild);
            
            // Select the new client
            select.value = newSiteId;
            document.getElementById('newClientForm').style.display = 'none';
            
            updateDeployCode(newSiteId);
            alert(`‚úÖ Cliente "${newSiteId}" creado. Genera la configuraci√≥n y copia el c√≥digo de deploy.`);
        }

        function updateDeployCode(siteId) {
            const deployCode = `&lt;script&gt;
  window.ChatWidget = {
    siteId: "${siteId}",
    configUrl: "https://dynamiccode-ochre.vercel.app/configs/{{siteId}}.json"
  };
&lt;/script&gt;
&lt;script async src="https://dynamiccode-ochre.vercel.app/chat-widget.js"&gt;&lt;/script&gt;`;
            
            document.getElementById('webflowCode').innerHTML = deployCode;
        }

        // Load current values
        window.addEventListener('load', function() {
            // Set default values from current config
            document.getElementById('label').value = "¬øNecesitas ayuda?";
            document.getElementById('teaserText').value = "¬°Hola! ¬øTe ayudo con algo?";
            
            // Load initial client config
            loadClientConfig();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Isolated Position Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { 
            background: #f8f9fa; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 4px; 
            border-left: 4px solid #007bff;
        }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
    </style>
</head>
<body>
    <h1>🎯 Isolated Position Test</h1>
    <p>Testing <strong>cliente-orange-001</strong> which should appear on the RIGHT</p>
    
    <button onclick="runTest()">🚀 Run Test</button>
    <button onclick="clearAll()">🧹 Clear</button>
    
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
        }

        function clearAll() {
            // Remove all widgets
            document.querySelectorAll('.ai-prl-chat-bubble, .ai-prl-chat-overlay, .ai-prl-smart-message, .ai-prl-chat-close').forEach(el => el.remove());
            
            // Remove all widget scripts
            document.querySelectorAll('script[src*="chat-widget"]').forEach(el => el.remove());
            
            // Reset global flag
            delete window.__aiPrlAssistLoaded;
            delete window.ChatWidget;
            
            // Clear results
            document.getElementById('results').innerHTML = '';
            
            log('🧹 Everything cleared', 'info');
        }

        async function runTest() {
            clearAll();
            
            log('🔄 Starting isolated test for cliente-orange-001...', 'info');
            
            try {
                // 1. Load config from API
                log('📡 Loading config from API...', 'info');
                const response = await fetch('https://dynamiccode-ochre.vercel.app/api/load-config?siteId=cliente-orange-001');
                const data = await response.json();
                
                log(`📊 API Response: position="${data.config.bubble.position}", color="${data.config.bubble.bg}"`, 'info');
                
                // 2. Verify the logic manually
                const expectedCSS = data.config.bubble.position === 'bl' ? 'left: 20px' : 'right: 20px';
                log(`🧮 Expected CSS: ${expectedCSS}`, 'info');
                
                if (data.config.bubble.position === 'br') {
                    log('✅ Position is "br" - should generate "right: 20px"', 'success');
                } else {
                    log('❌ Position is not "br" - this is unexpected!', 'error');
                    return;
                }
                
                // 3. Load the widget script
                log('📜 Loading widget script...', 'info');
                const script = document.createElement('script');
                script.src = 'https://dynamiccode-ochre.vercel.app/chat-widget-db.js?' + Date.now();
                
                script.onload = () => {
                    log('✅ Widget script loaded successfully', 'success');
                    
                    // 4. Setup widget
                    log('⚙️ Setting up widget with siteId: cliente-orange-001', 'info');
                    window.ChatWidget.setup({
                        siteId: 'cliente-orange-001',
                        analytics: true
                    });
                    
                    // 5. Check result after delay
                    setTimeout(() => {
                        const bubble = document.querySelector('.ai-prl-chat-bubble');
                        
                        if (!bubble) {
                            log('❌ No bubble found in DOM!', 'error');
                            return;
                        }
                        
                        log('✅ Bubble found in DOM', 'success');
                        
                        const styles = window.getComputedStyle(bubble);
                        const leftValue = styles.left;
                        const rightValue = styles.right;
                        
                        log(`💻 Computed styles: left="${leftValue}", right="${rightValue}"`, 'info');
                        
                        // Determine actual position
                        if (rightValue !== 'auto' && rightValue !== '0px' && parseInt(rightValue) > 0) {
                            log('✅ SUCCESS: Bubble is positioned on the RIGHT!', 'success');
                        } else if (leftValue !== 'auto' && leftValue !== '0px' && parseInt(leftValue) > 0) {
                            log('❌ BUG: Bubble is positioned on the LEFT (should be RIGHT)!', 'error');
                            
                            // Debug the CSS
                            log('🔍 Debugging CSS...', 'info');
                            const styleElements = document.querySelectorAll('style');
                            styleElements.forEach((style, index) => {
                                if (style.textContent.includes('ai-prl-chat-bubble')) {
                                    log(`🎨 Style element ${index + 1}:`, 'info');
                                    const lines = style.textContent.split('\n');
                                    lines.forEach(line => {
                                        if (line.includes('left:') || line.includes('right:')) {
                                            log(`    ${line.trim()}`, 'info');
                                        }
                                    });
                                }
                            });
                        } else {
                            log('⚠️ Position is unclear - both left and right are auto/0px', 'error');
                        }
                        
                    }, 3000);
                };
                
                script.onerror = () => {
                    log('❌ Failed to load widget script!', 'error');
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }

        // Auto-start
        window.onload = () => {
            log('🚀 Isolated test page loaded - click "Run Test" to start', 'info');
        };
    </script>
</body>
</html>






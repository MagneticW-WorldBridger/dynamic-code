<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐛 DEBUG POSITION ISSUE</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }
        #debugOutput {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>🐛 DEBUG: Position Issue Deep Dive</h1>
    
    <div class="debug-info">
        <h3>🔍 ISSUE:</h3>
        <p>cliente-orange-001 has position="br" in database but appears LEFT instead of RIGHT</p>
        <button onclick="debugPosition()">🔍 Debug Position Logic</button>
        <button onclick="loadWidget()">🚀 Load Widget</button>
        <button onclick="inspectCSS()">🎨 Inspect CSS</button>
    </div>

    <div id="debugOutput"></div>

    <script>
        let output = document.getElementById('debugOutput');
        
        function log(msg) {
            output.textContent += new Date().toLocaleTimeString() + ': ' + msg + '\n';
            output.scrollTop = output.scrollHeight;
        }

        async function debugPosition() {
            log('🔄 Loading config from API...');
            
            try {
                const response = await fetch('https://dynamiccode-ochre.vercel.app/api/load-config?siteId=cliente-orange-001');
                const data = await response.json();
                
                log('📊 API Response:');
                log('  - position: ' + data.config.bubble.position);
                log('  - Expected CSS: ' + (data.config.bubble.position === 'bl' ? 'left: 20px' : 'right: 20px'));
                
                // Test the logic manually
                const position = data.config.bubble.position;
                log('🧮 Logic test:');
                log('  - position === "bl": ' + (position === 'bl'));
                log('  - Should result in: ' + (position === 'bl' ? 'left: 20px' : 'right: 20px'));
                
            } catch (error) {
                log('❌ Error: ' + error.message);
            }
        }

        async function loadWidget() {
            log('🚀 Loading widget...');
            
            // Clear any existing widgets
            const existing = document.querySelectorAll('.ai-prl-chat-bubble, .ai-prl-chat-overlay');
            existing.forEach(el => el.remove());
            
            // Reset the loaded flag
            window.__aiPrlAssistLoaded = false;
            
            const script = document.createElement('script');
            script.src = 'https://dynamiccode-ochre.vercel.app/chat-widget-db.js?' + Date.now();
            script.onload = () => {
                log('✅ Script loaded, calling setup...');
                
                window.ChatWidget.setup({
                    siteId: 'cliente-orange-001',
                    analytics: true
                });
                
                // Check after 3 seconds
                setTimeout(inspectCSS, 3000);
            };
            
            document.head.appendChild(script);
        }

        function inspectCSS() {
            log('🎨 Inspecting CSS...');
            
            const bubbles = document.querySelectorAll('.ai-prl-chat-bubble');
            log('📊 Found ' + bubbles.length + ' bubble(s)');
            
            bubbles.forEach((bubble, index) => {
                const styles = window.getComputedStyle(bubble);
                log(`🔍 Bubble ${index + 1}:`);
                log('  - left: ' + styles.left);
                log('  - right: ' + styles.right);
                log('  - position: ' + styles.position);
                log('  - display: ' + styles.display);
                
                // Get the actual CSS rule
                const styleSheets = Array.from(document.styleSheets);
                log('  - Checking stylesheets for rules...');
                
                // Check inline styles
                if (bubble.style.cssText) {
                    log('  - Inline styles: ' + bubble.style.cssText);
                }
                
                // Check parent element styles
                const parent = bubble.parentElement;
                if (parent) {
                    const parentStyles = window.getComputedStyle(parent);
                    log('  - Parent position: ' + parentStyles.position);
                }
            });
            
            // Also check for any style elements
            const styleElements = document.querySelectorAll('style');
            log('📝 Found ' + styleElements.length + ' style element(s)');
            
            styleElements.forEach((style, index) => {
                if (style.textContent.includes('ai-prl-chat-bubble')) {
                    log(`🎨 Style ${index + 1} contains bubble CSS:`);
                    const lines = style.textContent.split('\n');
                    lines.forEach(line => {
                        if (line.includes('left:') || line.includes('right:') || line.includes('position:')) {
                            log('    ' + line.trim());
                        }
                    });
                }
            });
        }

        // Auto-start
        window.onload = () => {
            log('🚀 Debug page loaded');
            debugPosition();
        };
    </script>
</body>
</html>






<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test New Widget (Research-Based)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8f9fa;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
        }
        .info {
            background: #e7f3ff;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .test-params {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üß™ New Widget Test (Research-Based)</h1>
        
        <div class="success">
            <strong>‚úÖ 2024 Research-Based Approach Active!</strong><br>
            This page tests the new Intercom/Rasa style widget embedding.
        </div>

        <div class="info">
            <strong>üî¨ What's Being Tested:</strong><br>
            ‚úÖ Shadow DOM isolation<br>
            ‚úÖ Async loading (non-blocking)<br>
            ‚úÖ UTM parameter capture<br>
            ‚úÖ Settings object approach<br>
            ‚úÖ GoHighLevel compatibility
        </div>

        <div class="test-params">
            <strong>üéØ Test UTM Parameters:</strong><br>
            Add these to the URL to test UTM capture:<br>
            <code>?utm_source=test&utm_campaign=research&utm_medium=widget</code>
        </div>

        <h2>Current Page Context:</h2>
        <ul>
            <li><strong>Host:</strong> <span id="host"></span></li>
            <li><strong>Page:</strong> <span id="page"></span></li>
            <li><strong>Referrer:</strong> <span id="referrer"></span></li>
            <li><strong>UTM Source:</strong> <span id="utm_source"></span></li>
            <li><strong>UTM Campaign:</strong> <span id="utm_campaign"></span></li>
        </ul>

        <h2>Widget Status:</h2>
        <div id="widgetStatus">Loading...</div>
    </div>

    <script>
        // Display page context
        document.getElementById('host').textContent = window.location.hostname;
        document.getElementById('page').textContent = window.location.href;
        document.getElementById('referrer').textContent = document.referrer || 'None';
        
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('utm_source').textContent = urlParams.get('utm_source') || 'None';
        document.getElementById('utm_campaign').textContent = urlParams.get('utm_campaign') || 'None';

        // Widget status checker
        setTimeout(() => {
            if (window.__aiPrlAssistLoaded) {
                document.getElementById('widgetStatus').innerHTML = 
                    '<div class="success">‚úÖ Widget loaded successfully!</div>';
            } else {
                document.getElementById('widgetStatus').innerHTML = 
                    '<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px;">‚ùå Widget failed to load</div>';
            }
        }, 3000);
    </script>

    <!-- AI PRL Assist Chat Widget (New Research-Based Approach) -->
    <script>
        window.ChatWidgetSettings = {
            siteId: "test-new-widget",
            serverUrl: "https://app.aiprlassist.com/webchat/",
            color: "#28a745",
            position: "bottom-right",
            size: 68,
            showDelay: 2000,
            utmCapture: true,
            analytics: true,
            windowMode: "windowed",
            windowWidth: 420,
            windowHeight: 650
        };
    </script>
    <script async src="https://dynamiccode-ochre.vercel.app/widget-improved.js"></script>
</body>
</html>
